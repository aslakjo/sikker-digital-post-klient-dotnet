using Microsoft.VisualStudio.TestTools.UnitTesting;
using Difi.SikkerDigitalPost.Klient.Domene.Entiteter.Kvitteringer;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;
using Difi.SikkerDigitalPost.Klient.Domene.Entiteter.Kvitteringer.Transport;
using Difi.SikkerDigitalPost.Klient.Tester.testdata.meldinger;
using Difi.SikkerDigitalPost.Klient.Tester.Utilities;

namespace Difi.SikkerDigitalPost.Klient.Domene.Entiteter.Kvitteringer.Tests
{
    [TestClass()]
    public class ForretningskvitteringTests
    {
        [TestClass]
        public class KonstruktørMethod : ForretningskvitteringTests
        {
            [TestMethod]
            public void EnkelKonstruktør()
            {
                //Arrange
                const string tidspunkt = "2015-11-09T14:27:44.587+01:00";
                const string meldingsId = "d7197447-2d8f-45d3-b846-4ab0a2d81b28";
                const string konversjonsId = "7f4172d2-9814-484b-90de-2f04fe68f6fa";
                const string referanseTilMeldingsId = "960e6184-da93-4c5c-ad84-4b52038c36bd";

                var råDataForetningskvittering =
                   string.Format("<env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\"><wsse:BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" wsu:Id=\"X509-f5967263-fcfc-4721-970d-2dd52173bcb2\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-9af533f9-95ef-45b5-b304-0064162e7e2e\"><wsu:Created>2015-11-09T13:30:58.117Z</wsu:Created><wsu:Expires>2015-11-09T13:35:58.117Z</wsu:Expires></wsu:Timestamp><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" Id=\"SIG-9070d77e-ddae-424e-89a4-68ff48b7657e\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"env\"/></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><ds:Reference URI=\"#id-e1534035-9a66-424f-8cd1-818494bd6645\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>0Ws8ZLEWuEsaIXwon/op/ST8sTiL+inGPJJib7mKZzA=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#TS-9af533f9-95ef-45b5-b304-0064162e7e2e\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"wsse env\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>1moFVEFNOwDA7m0V85vh5wY938+QbBNFYh+hQfzX4Fk=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#id-27cb17ae-099c-44a0-b0c2-c08c2edbfa24\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>x+doNPtw9+LFIrZ6POZj4cvnQ2qgrAPO/+HuIIG2Qms=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>oHOrvOHwG6eaGMVRUJentCdpPB8ugH0WNSVH/Mm0QkBgGfbqZk/q7WesDaOwTyp/MPxKXQCr0C6ch6nMIXdx9HlUyc8qHszKO+bTCILKr4GyBXiAmRuysiubiBEECI7Kijd2NeJKbv7fMNd7Tao5do0LwVZ6FjGE/pB3LHOFbgcLPQalL9nF8rC9Cfco8BeUTqo8rmDJwew2f+xdP355eC20m4Bhir/1ZOzGqpRX5y5AmYN/NaerdFYH8LYH7auseAoVp51vsTfg2MlwzjiYWgG+VUlSX3dteCyt5jvgekOrfKolpTEeBUeeYw+VhQJterXhlg4fbMO5gu5mTCo9Hg==</ds:SignatureValue><ds:KeyInfo Id=\"KI-3425a255-ebc0-4d6f-85d3-0ab4d9386d82\"><wsse:SecurityTokenReference wsu:Id=\"STR-f8a57f16-c03b-4959-a36c-5720797ed4cf\"><wsse:Reference URI=\"#X509-f5967263-fcfc-4721-970d-2dd52173bcb2\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\"/></wsse:SecurityTokenReference></ds:KeyInfo></ds:Signature></wsse:Security><eb:Messaging xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-27cb17ae-099c-44a0-b0c2-c08c2edbfa24\"><ns6:UserMessage xmlns:ns10=\"http://uri.etsi.org/2918/v1.2.1#\" xmlns:ns11=\"http://uri.etsi.org/01903/v1.3.2#\" xmlns:ns2=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns4=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:ns5=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ns6=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:ns7=\"http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0\" xmlns:ns8=\"http://www.w3.org/1999/xlink\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\" mpc=\"urn:prioritert:queue1\"><ns6:MessageInfo><ns6:Timestamp>2015-11-09T14:30:58.115+01:00</ns6:Timestamp><ns6:MessageId>{1}</ns6:MessageId><ns6:RefToMessageId>{3}</ns6:RefToMessageId></ns6:MessageInfo><ns6:PartyInfo><ns6:From><ns6:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns6:PartyId><ns6:Role>urn:sdp:meldingsformidler</ns6:Role></ns6:From><ns6:To><ns6:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns6:PartyId><ns6:Role>urn:sdp:avsender</ns6:Role></ns6:To></ns6:PartyInfo><ns6:CollaborationInfo><ns6:AgreementRef>http://begrep.difi.no/SikkerDigitalPost/1.0/transportlag/Meldingsutveksling/FormidleDigitalPostForsendelse</ns6:AgreementRef><ns6:Service>SDP</ns6:Service><ns6:Action>KvitteringsForespoersel</ns6:Action><ns6:ConversationId>e8dc1e6e-f06c-4e82-bb8a-d01ebdf4994d</ns6:ConversationId></ns6:CollaborationInfo><ns6:PayloadInfo><ns6:PartInfo/></ns6:PayloadInfo></ns6:UserMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"id-e1534035-9a66-424f-8cd1-818494bd6645\"><ns3:StandardBusinessDocument xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\"><ns3:StandardBusinessDocumentHeader><ns3:HeaderVersion>1.0</ns3:HeaderVersion><ns3:Sender><ns3:Identifier Authority=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns3:Identifier></ns3:Sender><ns3:Receiver><ns3:Identifier Authority=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns3:Identifier></ns3:Receiver><ns3:DocumentIdentification><ns3:Standard>urn:no:difi:sdp:1.0</ns3:Standard><ns3:TypeVersion>1.0</ns3:TypeVersion><ns3:InstanceIdentifier>e8dc1e6e-f06c-4e82-bb8a-d01ebdf4994d</ns3:InstanceIdentifier><ns3:Type>kvittering</ns3:Type><ns3:CreationDateAndTime>2015-11-09T14:27:44.587+01:00</ns3:CreationDateAndTime></ns3:DocumentIdentification><ns3:BusinessScope><ns3:Scope><ns3:Type>ConversationId</ns3:Type><ns3:InstanceIdentifier>{2}</ns3:InstanceIdentifier><ns3:Identifier>urn:no:difi:sdp:1.0</ns3:Identifier></ns3:Scope></ns3:BusinessScope></ns3:StandardBusinessDocumentHeader><ns9:kvittering><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>E+5x1oNrylNsnaljSjDrDzcUNHXgwi10JW+Sy1SlA0A=</DigestValue></Reference></SignedInfo><SignatureValue>WwhutiDiFQwFVn7HSoblgvtSzIWQHK68Ge1jCsgnvrRcndmpocJ0jKiJ4D7vT9qodiduoz03YY1dwaAeWiKdbKS+0lr/Rak0hIeCrgygkTjwcQuX+A+WtU6oiVoEn9j8PQE21aqhTN4ru8MwD6HzYAmz22pYazyJEr6BP9i93vGSf8p1ZprrJhEVUpdQJz2LO/EHpIn6BT7rviyA5KEqOMw0mxjrYF/pKLuQuZrY3Qvb0JgyqEsFtmRAOLCX7E0KW67h3PW461EDZWpjxPvv3Ca9XRWbpjrl2uQBqMPMEx5Q1o75pLlFK592/xjj0BgdXcLMijrPQNKpJTsJxqVYMw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIE7jCCA9agAwIBAgIKGBZrmEgzTHzeJjANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzA1MVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCLCxU4oBhtGmJxXZWbdWdzO2uA3eRNW/kPdddL1HYl1iXLV/g+H2Q0ELadWLggkS+1kOd8/jKxEN++biMmmDqqCWbzNdmEd1j4lctSlH6M7tt0ywmXIYdZMz5kxcLAMNXsaqnPdikI9uPJZQEL3Kc8hXhXISvpzP7gYOvKHg41uCxu1xCZQOM6pTlNbxemBYqvES4fRh2xvB9aMjwkB4Nz8jrIsyoPI89i05OmGMkI5BPZt8NTa40Yf3yU+SQECW0GWalB5cxaTMeB01tqslUzBJPV3cQx+AhtQG4hkOhQnAMDJramSPVtwbEnqOjQ+lyNmg5GQ4FJO02ApKJTZDTHAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBQ1gsJfVC7KYGiWVLP7ZwzppyVYTTAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCe67UOZ/VSwcH2ov1cOSaWslL7JNfqhyNZWGpfgX1c0Gh+KkO3eVkMSozpgX6M4eeWBWJGELMiVN1LhNaGxBU9TBMdeQ3SqK219W6DXRJ2ycBtaVwQ26V5tWKRN4UlRovYYiY+nMLx9VrLOD4uoP6fm9GE5Fj0vSMMPvOEXi0NsN+8MUm3HWoBeUCLyFpe7/EPsS/Wud5bb0as/E2zIztRodxfNsoiXNvWaP2ZiPWFunIjK1H/8EcktEW1paiPd8AZek/QQoG0MKPfPIJuqH+WJU3a8J8epMDyVfaek+4+l9XOeKwVXNSOP/JSwgpOJNzTdaDOM+uVuk75n2191Fd7</X509Certificate></X509Data></KeyInfo></Signature><ns9:tidspunkt>{0}</ns9:tidspunkt><ns9:levering/></ns9:kvittering></ns3:StandardBusinessDocument></env:Body></env:Envelope>", tidspunkt, meldingsId, konversjonsId, referanseTilMeldingsId);
                var foretningsKvittering = KvitteringFactory.GetForretningskvittering(råDataForetningskvittering);
                
                //Act
                
                
                //Assert
                Assert.AreEqual( DateTime.Parse(tidspunkt), foretningsKvittering.Tidspunkt); 
                Assert.AreEqual(konversjonsId,foretningsKvittering.KonversasjonsId.ToString());
                Assert.AreEqual(meldingsId,foretningsKvittering.MeldingsId);
                Assert.AreEqual(referanseTilMeldingsId,foretningsKvittering.ReferanseTilMeldingId);
            }
        }

       
    }
}