using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Security.Cryptography;
using System.Xml;
using Difi.SikkerDigitalPost.Klient.Security;
using Difi.SikkerDigitalPost.Klient.Utilities;

namespace Difi.SikkerDigitalPost.Klient.XmlValidering.Tests
{
    [TestClass()]
    public class ResponsvalidatorTester
    {
        //Send melding
        private const string _sendtMeldingXmlTestMiljø = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><wsse:BinarySecurityToken wsu:Id=\"X509-513ffecb-cd7e-4bb3-a4c5-47eff314683f\" EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-76740c34-88d2-4bb6-82d2-9e9f0e474087\"><wsu:Created>2015-10-22T14:27:46.624Z</wsu:Created><wsu:Expires>2015-10-22T14:29:46.624Z</wsu:Expires></wsu:Timestamp><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><InclusiveNamespaces PrefixList=\"env\" xmlns=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></CanonicalizationMethod><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"#soapBody\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>clCREk3SJj5Y+FZ9oD8cnlMg1SDR74d8rXNcZQQIl8A=</DigestValue></Reference><Reference URI=\"#TS-76740c34-88d2-4bb6-82d2-9e9f0e474087\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><InclusiveNamespaces PrefixList=\"wsse env\" xmlns=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transform></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>Uq7XpT9Xy2J2ony7FZUgbikl1fdni5HjZ2ZBA3IYeXs=</DigestValue></Reference><Reference URI=\"#id-68ae7123-bf5c-4d15-835c-4a6b91106e77\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>m+4+GqE3EclYqY02BqzzqEP9q7p1kJxVBLUtV2jKnu0=</DigestValue></Reference><Reference URI=\"cid:4fa27c07-8a0f-45a9-954e-c658f6c480af@meldingsformidler.sdp.difi.no\"><Transforms><Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>5jQFrdmBGPCSWj5Sq4bVoYyfrF8vAYqKl1h3m/l1j5o=</DigestValue></Reference></SignedInfo><SignatureValue>IIeHVdMF+mX6QJmUDcnuHxcBA4CU2iiKh9qzZieyEBYmvnBsJWfYMqWIurW9fJDTrzF+G7qVZYEhKfFYewe/2a3g/8qkYnyI0DNugJypkZmoA9BoZ624M6zU0gf8BxGO2hBsXbinlKcrg/5Q2JoLyVt8iuDvrqV7nZj206lbXpkZvh5QnD/TRvNuLHS2OfRIxUBrfR8DaxCH1WU3gB8p434RO2NfJTS/ud52u3nXGiJc9sS+Q+UVnYwcLn2jXE22FRTGRIm3VkSMs6f8kpvIkJtAQB7Z29VDP0q++fnqCSBCaaGrfoWf76Obak0S3xdpcteDmDkR84HeQpFWqPAsFg==</SignatureValue><KeyInfo><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#X509-513ffecb-cd7e-4bb3-a4c5-47eff314683f\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" /></SecurityTokenReference></KeyInfo></Signature></wsse:Security><eb:Messaging xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-68ae7123-bf5c-4d15-835c-4a6b91106e77\" xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\"><eb:UserMessage mpc=\"urn:prioritert:queue1\"><eb:MessageInfo><eb:Timestamp>2015-10-22T14:27:46.625Z</eb:Timestamp><eb:MessageId>388214db-29cc-43c7-9543-877e017e5bb4</eb:MessageId></eb:MessageInfo><eb:PartyInfo><eb:From><eb:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</eb:PartyId><eb:Role>urn:sdp:avsender</eb:Role></eb:From><eb:To><eb:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</eb:PartyId><eb:Role>urn:sdp:meldingsformidler</eb:Role></eb:To></eb:PartyInfo><eb:CollaborationInfo><eb:AgreementRef>http://begrep.difi.no/SikkerDigitalPost/1.0/transportlag/Meldingsutveksling/FormidleDigitalPostForsendelse</eb:AgreementRef><eb:Service>SDP</eb:Service><eb:Action>FormidleDigitalPost</eb:Action><eb:ConversationId>21ac6b3b-1a02-406b-bd43-c915e4d1bf23</eb:ConversationId></eb:CollaborationInfo><eb:PayloadInfo><eb:PartInfo href=\"#soapBody\" /><eb:PartInfo href=\"cid:4fa27c07-8a0f-45a9-954e-c658f6c480af@meldingsformidler.sdp.difi.no\"><eb:PartProperties><eb:Property name=\"MimeType\">application/cms</eb:Property><eb:Property name=\"Content\">sdp:Dokumentpakke</eb:Property></eb:PartProperties></eb:PartInfo></eb:PayloadInfo></eb:UserMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"soapBody\"><ns3:StandardBusinessDocument xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns5=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\"><ns3:StandardBusinessDocumentHeader><ns3:HeaderVersion>1.0</ns3:HeaderVersion><ns3:Sender><ns3:Identifier Authority=\"iso6523-actorid-upis\">9908:984661185</ns3:Identifier></ns3:Sender><ns3:Receiver><ns3:Identifier Authority=\"iso6523-actorid-upis\">9908:984661185</ns3:Identifier></ns3:Receiver><ns3:DocumentIdentification><ns3:Standard>urn:no:difi:sdp:1.0</ns3:Standard><ns3:TypeVersion>1.0</ns3:TypeVersion><ns3:InstanceIdentifier>388214db-29cc-43c7-9543-877e017e5bb4</ns3:InstanceIdentifier><ns3:Type>digitalPost</ns3:Type><ns3:CreationDateAndTime>2015-10-22T14:27:46.627Z</ns3:CreationDateAndTime></ns3:DocumentIdentification><ns3:BusinessScope><ns3:Scope><ns3:Type>ConversationId</ns3:Type><ns3:InstanceIdentifier>21ac6b3b-1a02-406b-bd43-c915e4d1bf23</ns3:InstanceIdentifier><ns3:Identifier>urn:no:difi:sdp:1.0</ns3:Identifier></ns3:Scope></ns3:BusinessScope></ns3:StandardBusinessDocumentHeader><ns9:digitalPost><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\" /><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><InclusiveNamespaces PrefixList=\"ns9\" xmlns=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transform></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>CGSn3Bp0aY6GlhjFz5/DR3HyilxCuLZen1vw1ul3OX0=</DigestValue></Reference></SignedInfo><SignatureValue>PRoHNZixUdSepswG+XFabUDIHLuvAE+0nib/ImdTyE+NyYh5KbdEj7I9DeJg6KFNFHGCkWTTp2CyfhFKl5L8Xdmcja5YGNA+MGZfQTmQfPld4T7sBAu4XqYhQhMheYIOGwUMknFnyz8ESrQ0gCOgdOl6V3q4BaekM8ZcPOoWugvrYNzy1xdfr3FXgh862/5ixbef/HqV6gQALzi5WWI2th52gpnydNQVanwlIOyMV2Yzq+pakZWuHFlrYKo0rSArtSB6J47Um4zfHdn40MBc4pBEZZFkETe+uCc2DmZPKign4bQ0yBbllKz6RYw80wZFTkvznLHW4u/iJmyMm2Qd+Q==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</X509Certificate></X509Data></KeyInfo></Signature><ns9:avsender><ns9:organisasjon authority=\"iso6523-actorid-upis\">9908:984661185</ns9:organisasjon><ns9:avsenderidentifikator>digipost</ns9:avsenderidentifikator><ns9:fakturaReferanse></ns9:fakturaReferanse></ns9:avsender><ns9:mottaker><ns9:person><ns9:personidentifikator>04036125433</ns9:personidentifikator><ns9:postkasseadresse>ove.jonsen#6K5A</ns9:postkasseadresse></ns9:person></ns9:mottaker><ns9:digitalPostInfo><ns9:virkningstidspunkt>2015-10-22T16:27:46.359+02:00</ns9:virkningstidspunkt><ns9:aapningskvittering>false</ns9:aapningskvittering><ns9:sikkerhetsnivaa>3</ns9:sikkerhetsnivaa><ns9:ikkeSensitivTittel lang=\"no\">Ikke-sensitiv tittel</ns9:ikkeSensitivTittel><ns9:varsler><ns9:smsVarsel><ns9:mobiltelefonnummer>12345678</ns9:mobiltelefonnummer><ns9:varslingsTekst lang=\"NO\">Et lite varsel pr SMS.</ns9:varslingsTekst><ns9:repetisjoner><ns9:dagerEtter>0</ns9:dagerEtter></ns9:repetisjoner></ns9:smsVarsel></ns9:varsler></ns9:digitalPostInfo><ns9:dokumentpakkefingeravtrykk><ns5:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ns5:DigestValue>5jQFrdmBGPCSWj5Sq4bVoYyfrF8vAYqKl1h3m/l1j5o=</ns5:DigestValue></ns9:dokumentpakkefingeravtrykk></ns9:digitalPost></ns3:StandardBusinessDocument></env:Body></env:Envelope>";
        private const string _responsTransportkvitteringXmlTestmiljø = "<env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\"><wsse:BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" wsu:Id=\"X509-aeb92311-5546-469e-b5e4-43e6ab95f3cb\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-a6855fa9-caef-4e05-bf70-6e1c64f8af30\"><wsu:Created>2015-10-22T14:27:47.188Z</wsu:Created><wsu:Expires>2015-10-22T14:32:47.188Z</wsu:Expires></wsu:Timestamp><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" Id=\"SIG-30bbc323-3557-4c21-afb1-b491839039de\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"env\" /></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><ds:Reference URI=\"#id-364cf5cf-c218-4f9f-b8a1-508ff8d44be6\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\" /></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>XryysQP3I8XTSL9icB3WCy17JxqqZIvNchNVzr9/rbc=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#TS-a6855fa9-caef-4e05-bf70-6e1c64f8af30\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"wsse env\" /></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>PuFI7dA66+N5d4Cov7GAdXYQq3wKBe8FwGknZtH/s4E=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#id-32f63b6e-871a-4926-9f39-47ca5428f5dd\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\" /></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ds:DigestValue>XI9g0I9fGSf/NVJVxe43kKCgF0OFdTc3F9SXSkE5PxA=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>iHhXDHohEm9cFfqz6sLc5JTUULKmhqXqCNKqDA+LoJETaR7mLF6buwlSBX4cDms6BbfY//z1RRxM8g6bEfjZtaPGBoRUUH5ar4+jJX74NDoFa37CPN/YjLNYfx98Ld5Gidx/DljDlXQg3NTwYks8LXj1NyjTWC1bQGVFA4Gw7WC81GrUpRTP8fN/WhiN3hliZB3Q04K6KLFq1DH7aYxEvlYkziXBE7pYjdeFLmFGm+cVkVWG4j2t0GCJ8c75XIXHh1ZXhAUwKUHislP3gJ0z0Jmmvbcn6oLcSdCHJ1WYwGe5sxfPiGIbfKwYR3DsyqTTyOnXsqGP/S9vUndQ/bpQDQ==</ds:SignatureValue><ds:KeyInfo Id=\"KI-f13436c9-4d8f-448a-a1ca-144612196271\"><wsse:SecurityTokenReference wsu:Id=\"STR-89d7395a-24f2-47a7-b79a-95679f4cbc31\"><wsse:Reference URI=\"#X509-aeb92311-5546-469e-b5e4-43e6ab95f3cb\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" /></wsse:SecurityTokenReference></ds:KeyInfo></ds:Signature></wsse:Security><eb:Messaging xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-32f63b6e-871a-4926-9f39-47ca5428f5dd\"><ns6:SignalMessage xmlns:ns10=\"http://uri.etsi.org/2918/v1.2.1#\" xmlns:ns11=\"http://uri.etsi.org/01903/v1.3.2#\" xmlns:ns2=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns4=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:ns5=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ns6=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:ns7=\"http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0\" xmlns:ns8=\"http://www.w3.org/1999/xlink\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\"><ns6:MessageInfo><ns6:Timestamp>2015-10-22T16:27:47.187+02:00</ns6:Timestamp><ns6:MessageId>604d8104-d957-435c-a7ec-d5611f97f249</ns6:MessageId><ns6:RefToMessageId>388214db-29cc-43c7-9543-877e017e5bb4</ns6:RefToMessageId></ns6:MessageInfo><ns6:Receipt><ns7:NonRepudiationInformation><ns7:MessagePartNRInformation><ns5:Reference URI=\"cid:4fa27c07-8a0f-45a9-954e-c658f6c480af@meldingsformidler.sdp.difi.no\"><ns5:Transforms><ns5:Transform Algorithm=\"http://docs.oasis-open.org/wss/oasis-wss-SwAProfile-1.1#Attachment-Content-Signature-Transform\" /></ns5:Transforms><ns5:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ns5:DigestValue>5jQFrdmBGPCSWj5Sq4bVoYyfrF8vAYqKl1h3m/l1j5o=</ns5:DigestValue></ns5:Reference></ns7:MessagePartNRInformation><ns7:MessagePartNRInformation><ns5:Reference URI=\"#soapBody\"><ns5:Transforms><ns5:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></ns5:Transforms><ns5:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><ns5:DigestValue>clCREk3SJj5Y+FZ9oD8cnlMg1SDR74d8rXNcZQQIl8A=</ns5:DigestValue></ns5:Reference></ns7:MessagePartNRInformation></ns7:NonRepudiationInformation></ns6:Receipt></ns6:SignalMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"id-364cf5cf-c218-4f9f-b8a1-508ff8d44be6\" /></env:Envelope>";

        //Hent kvittering
        private const string _sendtKvitteringsforespørsel = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><wsse:BinarySecurityToken wsu:Id=\"X509-62066988-e736-4ae6-a7f7-40d21e536e4d\" EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-002031ee-0325-4dda-b136-3b0d1b082be5\"><wsu:Created>2015-10-20T13:11:10.437Z</wsu:Created><wsu:Expires>2015-10-20T13:13:10.437Z</wsu:Expires></wsu:Timestamp><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><InclusiveNamespaces PrefixList=\"env\" xmlns=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></CanonicalizationMethod><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\" /><Reference URI=\"#soapBody\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>bESP4Ndg/0VjAt/ul3Y6LE6Qiz3juGBqZDsM3IwKGug=</DigestValue></Reference><Reference URI=\"#TS-002031ee-0325-4dda-b136-3b0d1b082be5\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><InclusiveNamespaces PrefixList=\"wsse env\" xmlns=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transform></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>Xp7ge8+cqsCOkVip2+BAsajm7Z+EI3EJcU92fMMhdCY=</DigestValue></Reference><Reference URI=\"#id-0e81c354-0743-41fa-88a4-180c2ed3357b\"><Transforms><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\" /></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\" /><DigestValue>FPugaPfqvdg9bkjuF10GxqFAGaV9rEoud9iKEYD5ERc=</DigestValue></Reference></SignedInfo><SignatureValue>p+A2m/N0R+0upTn8HXSAIzJtoHaGsSBEJdbbycLEFLraA2yhA15AVui74/QpplsylcAK4bnS0hiZz/5OvANXa9ym8ZBwLmRK+Qfy6DroAB4GZNfRq65FwBhywqK3jN838zAdFPscNa3onxvdZFBrzxgoR02+9uW2oo6VybddsEJHyD4D7ZHNOctgc50klHbri1XzG+XtlHY6Dj9/w/YK8WT76rRkuLbNY/AepCTfNAS3ACp3wEK3X9ypX7DLH4/yX6X8u2yFrCk+6TqshdJ1qx8pKjdTS9ZM8+0WjiJhFuHDEd7O928SQzQxhEFIc3RNjHr+NrBRJdSFDjJqlylnkA==</SignatureValue><KeyInfo><SecurityTokenReference xmlns=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"><Reference URI=\"#X509-62066988-e736-4ae6-a7f7-40d21e536e4d\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" /></SecurityTokenReference></KeyInfo></Signature></wsse:Security><eb:Messaging xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-0e81c354-0743-41fa-88a4-180c2ed3357b\" xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\"><eb:SignalMessage><eb:MessageInfo><eb:Timestamp>2015-10-20T13:11:10.437Z</eb:Timestamp><eb:MessageId>27be62c5-5b0f-49d9-8cf8-3b4419a98e91</eb:MessageId></eb:MessageInfo><eb:PullRequest mpc=\"urn:prioritert:queue1\" /></eb:SignalMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"soapBody\" /></env:Envelope>";
        private const string _responsKvitteringsForespørsel = "<env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\"><wsse:BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" wsu:Id=\"X509-dcebd216-04d8-4357-9e96-2d0af6f7135b\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-39c20bbb-8e1c-44f7-8cff-0911d33d5a6f\"><wsu:Created>2015-10-20T13:11:10.656Z</wsu:Created><wsu:Expires>2015-10-20T13:16:10.656Z</wsu:Expires></wsu:Timestamp><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" Id=\"SIG-44b62459-7f10-49b2-8062-bc7c1786c7f3\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"env\"/></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><ds:Reference URI=\"#id-08269216-1fc0-43df-9c35-df6ce2c973b5\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>Dev21hQeb8KK5DAL47RXZVvqH0iWJ46cLRK3NwaVNxA=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#TS-39c20bbb-8e1c-44f7-8cff-0911d33d5a6f\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"wsse env\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>K2bo4IGPmCCwZIAHut5nYiTWAeQ4y7j4p97Mg9nRJh0=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#id-d04ea0c5-bb5c-45c4-b89e-dfa95a2aa8dd\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>kbIW4Pfz1yeJviLQ+It+LCw80NWkJhsvdazQYkJNmEg=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>IaIzOMKz72crbSdrQrTpatpSoqMN3V4/FdYMQpbx9NE0xulPkrCmHG3At23q/0hjKYo77VND3RMFX3CPmaaJyo652wZDnxWw6i7NCfWZEvaxcD0hdFfZF5EV46CwBmKxvRbfl38xwxpT88l4SpNrFHb/pTaXqR2euCh26MUbbs+dSI1LCe0J31DbKF18bSGzAmv5GAKEOpGXaBJZ/CK1rG1nwV/PG5VTL6mstskiyeqOBXJwDhlegTCak+HgiZMWvkPnNjPZZ4UdRN0gHEUYyx/fbPbCCv2PSSXiB1geTkvxfL4DO12Gey2hodZ9g33vL5y1q0COhXcCCS5R/sJwUg==</ds:SignatureValue><ds:KeyInfo Id=\"KI-52ad73ff-968f-4e08-b94e-dcb031e60966\"><wsse:SecurityTokenReference wsu:Id=\"STR-03b3faec-c5c1-48f7-9499-3c4b35e3048c\"><wsse:Reference URI=\"#X509-dcebd216-04d8-4357-9e96-2d0af6f7135b\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\"/></wsse:SecurityTokenReference></ds:KeyInfo></ds:Signature></wsse:Security><eb:Messaging xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-d04ea0c5-bb5c-45c4-b89e-dfa95a2aa8dd\"><ns6:UserMessage xmlns:ns10=\"http://uri.etsi.org/2918/v1.2.1#\" xmlns:ns11=\"http://uri.etsi.org/01903/v1.3.2#\" xmlns:ns2=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns4=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:ns5=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ns6=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:ns7=\"http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0\" xmlns:ns8=\"http://www.w3.org/1999/xlink\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\" mpc=\"urn:prioritert:queue1\"><ns6:MessageInfo><ns6:Timestamp>2015-10-20T15:11:10.654+02:00</ns6:Timestamp><ns6:MessageId>eb546aa9-07e9-4f7a-b141-edb77613d2dd</ns6:MessageId><ns6:RefToMessageId>27be62c5-5b0f-49d9-8cf8-3b4419a98e91</ns6:RefToMessageId></ns6:MessageInfo><ns6:PartyInfo><ns6:From><ns6:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns6:PartyId><ns6:Role>urn:sdp:meldingsformidler</ns6:Role></ns6:From><ns6:To><ns6:PartyId type=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns6:PartyId><ns6:Role>urn:sdp:avsender</ns6:Role></ns6:To></ns6:PartyInfo><ns6:CollaborationInfo><ns6:AgreementRef>http://begrep.difi.no/SikkerDigitalPost/1.0/transportlag/Meldingsutveksling/FormidleDigitalPostForsendelse</ns6:AgreementRef><ns6:Service>SDP</ns6:Service><ns6:Action>KvitteringsForespoersel</ns6:Action><ns6:ConversationId>442bbb88-f52a-4055-b27c-d2f856239391</ns6:ConversationId></ns6:CollaborationInfo><ns6:PayloadInfo><ns6:PartInfo/></ns6:PayloadInfo></ns6:UserMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"id-08269216-1fc0-43df-9c35-df6ce2c973b5\"><ns3:StandardBusinessDocument xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\"><ns3:StandardBusinessDocumentHeader><ns3:HeaderVersion>1.0</ns3:HeaderVersion><ns3:Sender><ns3:Identifier Authority=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns3:Identifier></ns3:Sender><ns3:Receiver><ns3:Identifier Authority=\"urn:oasis:names:tc:ebcore:partyid-type:iso6523:9908\">9908:984661185</ns3:Identifier></ns3:Receiver><ns3:DocumentIdentification><ns3:Standard>urn:no:difi:sdp:1.0</ns3:Standard><ns3:TypeVersion>1.0</ns3:TypeVersion><ns3:InstanceIdentifier>442bbb88-f52a-4055-b27c-d2f856239391</ns3:InstanceIdentifier><ns3:Type>kvittering</ns3:Type><ns3:CreationDateAndTime>2015-10-20T15:03:02.411+02:00</ns3:CreationDateAndTime></ns3:DocumentIdentification><ns3:BusinessScope><ns3:Scope><ns3:Type>ConversationId</ns3:Type><ns3:InstanceIdentifier>08f3968a-9f35-4518-b17e-972e9a1be9d2</ns3:InstanceIdentifier><ns3:Identifier>urn:no:difi:sdp:1.0</ns3:Identifier></ns3:Scope></ns3:BusinessScope></ns3:StandardBusinessDocumentHeader><ns9:kvittering><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>yO/eQVlRXJikh6SEh4gtMuuAH6SsB4aC0DR8Z9Chi2E=</DigestValue></Reference></SignedInfo><SignatureValue>gJJ2knU3mMH5t/NuQMtNK87cJMza775KcIOhlLGZSv/tgGJSj2p/yRdo7O2mYv/Yn+tV8XF2zUOrMj7la4VfhjHisNaKegv8lVcwpOS1saZ/DSAeWlBZCdKmQ5JExatp0uT0JHUTwk3ok9kWVXL9oBcIhIGnjpiLo5hMM2QCGWZR5Xo7YreL+ftaaIYVOmBwIqLvCsUJLzgxSAFMj/nCWkNApMmwfxoWztPsVckWsRDTExgqssd9H9W0kzJYSCRQgp59K+Rr+ow13x7K8le9qEYE/1UapJDovaWHlzLyCe2plyPHzc3nayNHv0CYiwiO5GeGP9ctx0ouN7E1QgY2bw==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIE7jCCA9agAwIBAgIKGBZrmEgzTHzeJjANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzA1MVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCLCxU4oBhtGmJxXZWbdWdzO2uA3eRNW/kPdddL1HYl1iXLV/g+H2Q0ELadWLggkS+1kOd8/jKxEN++biMmmDqqCWbzNdmEd1j4lctSlH6M7tt0ywmXIYdZMz5kxcLAMNXsaqnPdikI9uPJZQEL3Kc8hXhXISvpzP7gYOvKHg41uCxu1xCZQOM6pTlNbxemBYqvES4fRh2xvB9aMjwkB4Nz8jrIsyoPI89i05OmGMkI5BPZt8NTa40Yf3yU+SQECW0GWalB5cxaTMeB01tqslUzBJPV3cQx+AhtQG4hkOhQnAMDJramSPVtwbEnqOjQ+lyNmg5GQ4FJO02ApKJTZDTHAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBQ1gsJfVC7KYGiWVLP7ZwzppyVYTTAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCe67UOZ/VSwcH2ov1cOSaWslL7JNfqhyNZWGpfgX1c0Gh+KkO3eVkMSozpgX6M4eeWBWJGELMiVN1LhNaGxBU9TBMdeQ3SqK219W6DXRJ2ycBtaVwQ26V5tWKRN4UlRovYYiY+nMLx9VrLOD4uoP6fm9GE5Fj0vSMMPvOEXi0NsN+8MUm3HWoBeUCLyFpe7/EPsS/Wud5bb0as/E2zIztRodxfNsoiXNvWaP2ZiPWFunIjK1H/8EcktEW1paiPd8AZek/QQoG0MKPfPIJuqH+WJU3a8J8epMDyVfaek+4+l9XOeKwVXNSOP/JSwgpOJNzTdaDOM+uVuk75n2191Fd7</X509Certificate></X509Data></KeyInfo></Signature><ns9:tidspunkt>2015-10-20T15:03:02.411+02:00</ns9:tidspunkt><ns9:levering/></ns9:kvittering></ns3:StandardBusinessDocument></env:Body></env:Envelope>";

        private const string _tomKøKvittering = "<env:Envelope xmlns:env=\"http://www.w3.org/2003/05/soap-envelope\"><env:Header><wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\"><wsse:BinarySecurityToken EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\" wsu:Id=\"X509-a314f611-d5cb-4299-ba33-ff792d816414\">MIIE7jCCA9agAwIBAgIKGBj1bv99Jpi+EzANBgkqhkiG9w0BAQsFADBRMQswCQYDVQQGEwJOTzEdMBsGA1UECgwUQnV5cGFzcyBBUy05ODMxNjMzMjcxIzAhBgNVBAMMGkJ1eXBhc3MgQ2xhc3MgMyBUZXN0NCBDQSAzMB4XDTE0MDQyNDEyMzExMVoXDTE3MDQyNDIxNTkwMFowVTELMAkGA1UEBhMCTk8xGDAWBgNVBAoMD1BPU1RFTiBOT1JHRSBBUzEYMBYGA1UEAwwPUE9TVEVOIE5PUkdFIEFTMRIwEAYDVQQFEwk5ODQ2NjExODUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLTnQryf2bmiyQ9q3ylQ6xMl7EhGIbjuziXkRTfL+M94m3ceAiko+r2piefKCiquLMK4j+UDcOapUtLC4dT4c6GhRH4FIOEn5aNS2I/njTenBypWka/VEhQUj7zvIh5G4UXIDIXYvLd7gideeMtkX24KUh2XVlh+PcqLGHirqBwVfFiTn5SKhr/ojhYYEb2xxTk3AY9nLd1MMffKQwUWmfoTos4scREYGI2R2vWxKWPcDqk+jig2DISWSJSuerz3HMYAAmp+Gjt0oFJNiyOFaFyGwT3DvqwOMQWwWXdmLh1NxMgTpghXAaXae76ucm9GDQ9E7ytf+JA096RWoi+5GtAgMBAAGjggHCMIIBvjAJBgNVHRMEAjAAMB8GA1UdIwQYMBaAFD+u9XgLkqNwIDVfWvr3JKBSAfBBMB0GA1UdDgQWBBTVyVLqcjWf1Qd0gsmCTrhXiWeqVDAOBgNVHQ8BAf8EBAMCBLAwFgYDVR0gBA8wDTALBglghEIBGgEAAwIwgbsGA1UdHwSBszCBsDA3oDWgM4YxaHR0cDovL2NybC50ZXN0NC5idXlwYXNzLm5vL2NybC9CUENsYXNzM1Q0Q0EzLmNybDB1oHOgcYZvbGRhcDovL2xkYXAudGVzdDQuYnV5cGFzcy5uby9kYz1CdXlwYXNzLGRjPU5PLENOPUJ1eXBhc3MlMjBDbGFzcyUyMDMlMjBUZXN0NCUyMENBJTIwMz9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0MIGKBggrBgEFBQcBAQR+MHwwOwYIKwYBBQUHMAGGL2h0dHA6Ly9vY3NwLnRlc3Q0LmJ1eXBhc3Mubm8vb2NzcC9CUENsYXNzM1Q0Q0EzMD0GCCsGAQUFBzAChjFodHRwOi8vY3J0LnRlc3Q0LmJ1eXBhc3Mubm8vY3J0L0JQQ2xhc3MzVDRDQTMuY2VyMA0GCSqGSIb3DQEBCwUAA4IBAQCmMpAGaNplOgx3b4Qq6FLEcpnMOnPlSWBC7pQEDWx6OtNUHDm56fBoyVQYKR6LuGfalnnOKuB/sGSmO3eYlh7uDK9WA7bsNU/W8ZiwYwF6PBRui2rrqYk3kj4NLTNlyh/AOO1a2FDFHu369W0zcjj5ns7qs0K3peXtLX8pVxA8RmjwdGe69P/2r6s2A5CBj7oXZJD0Yo2dJFdsZzonT900sUi+MWzlhj3LxU5/684NWc2NI6ZPof/dyYpy3K/AFzpDLWGSmaDO66hPl7EfoJxEiX0DNBaQzNIyRFPh0ir0jM+32ZQ4goR8bAtyhKeTyA/4+Qx1WQXS3wURCC0lsbMh</wsse:BinarySecurityToken><wsu:Timestamp wsu:Id=\"TS-7395d0c9-71e3-4f60-9b4b-3cc0661b4000\"><wsu:Created>2015-10-22T14:55:27.051Z</wsu:Created><wsu:Expires>2015-10-22T15:00:27.051Z</wsu:Expires></wsu:Timestamp><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" Id=\"SIG-09f34851-fc55-40c0-990e-260599974caa\"><ds:SignedInfo><ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"env\"/></ds:CanonicalizationMethod><ds:SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><ds:Reference URI=\"#id-7aa3af40-807d-4949-bd44-a29dd1f7f3f2\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>cw5GILAvJiLwOkSQvV7Q8/uStqDxMaEmmFejvByezB0=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#TS-7395d0c9-71e3-4f60-9b4b-3cc0661b4000\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"wsse env\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>wNJ6YSnEwmDiy6dJo+WJ7gcxdHWLCKcfTlgKzJxHZKI=</ds:DigestValue></ds:Reference><ds:Reference URI=\"#id-4fdc7e13-76d4-4d29-9e79-31b6121d6699\"><ds:Transforms><ds:Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"><ec:InclusiveNamespaces xmlns:ec=\"http://www.w3.org/2001/10/xml-exc-c14n#\" PrefixList=\"\"/></ds:Transform></ds:Transforms><ds:DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><ds:DigestValue>VD1xMk2GK+wTMlnt2t7xEClvzrt6nsVxF+GB4zFBsnU=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>fZIksQwXG5zwSm4iMjMflOXX5R8ArYWPilrp1v0ld7j58SoYCyiItJgm7Ifw/wXrs33x6v30R3DTJyhzeDJZmfDGRIt0jZJ0rTQ/wlhAEoyXaW6H2cTwJkffHjRNFA2DqRWLsg0JTGpBpQIEPh3FS5JLeAvHMyILku2wK/Y9IYvya8KoMTqKG6wEhwvIRIn1pk47F3OYOeAePD0j6oJ8udfU0v7BoCDtNtuizsvQyrmy1+qRVq8Kwwi7W3Tl7VxeD1tW5XCBDAgHcuTi7dHfMkvLHSW8Th3lq8V9Bwn3t7kQ7HbonMcNq+K/1Ni6elh05YWYqTpzc42qYH97ydbNcA==</ds:SignatureValue><ds:KeyInfo Id=\"KI-4a09c3af-f05f-4789-a9cc-079f611ccdc9\"><wsse:SecurityTokenReference wsu:Id=\"STR-e413fa8f-dd21-4c9b-ba20-0c71002d0058\"><wsse:Reference URI=\"#X509-a314f611-d5cb-4299-ba33-ff792d816414\" ValueType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\"/></wsse:SecurityTokenReference></ds:KeyInfo></ds:Signature></wsse:Security><eb:Messaging xmlns:eb=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"true\" wsu:Id=\"id-4fdc7e13-76d4-4d29-9e79-31b6121d6699\"><ns6:SignalMessage xmlns:ns10=\"http://uri.etsi.org/2918/v1.2.1#\" xmlns:ns11=\"http://uri.etsi.org/01903/v1.3.2#\" xmlns:ns2=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ns3=\"http://www.unece.org/cefact/namespaces/StandardBusinessDocumentHeader\" xmlns:ns4=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:ns5=\"http://www.w3.org/2000/09/xmldsig#\" xmlns:ns6=\"http://docs.oasis-open.org/ebxml-msg/ebms/v3.0/ns/core/200704/\" xmlns:ns7=\"http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0\" xmlns:ns8=\"http://www.w3.org/1999/xlink\" xmlns:ns9=\"http://begrep.difi.no/sdp/schema_v10\"><ns6:MessageInfo><ns6:Timestamp>2015-10-22T16:55:27.050+02:00</ns6:Timestamp><ns6:MessageId>9fa007b0-b82e-4442-b697-8f289597b008</ns6:MessageId><ns6:RefToMessageId>3da93d6d-575b-46ce-b4c3-f252fb918f91</ns6:RefToMessageId></ns6:MessageInfo><ns6:Error category=\"Communication\" errorCode=\"EBMS:0006\" origin=\"ebMS\" refToMessageInError=\"3da93d6d-575b-46ce-b4c3-f252fb918f91\" severity=\"warning\" shortDescription=\"EmptyMessagePartitionChannel\"><ns6:Description xml:lang=\"en\">There is no message available for pulling from this MPC at this moment.</ns6:Description></ns6:Error></ns6:SignalMessage></eb:Messaging></env:Header><env:Body xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" wsu:Id=\"id-7aa3af40-807d-4949-bd44-a29dd1f7f3f2\"/></env:Envelope>";


        private XmlDocument SendtMeldingXmlDocument
        {
            get
            {
                XmlDocument sendtMelding = new XmlDocument();
                sendtMelding.LoadXml(_sendtMeldingXmlTestMiljø); 
                return sendtMelding;
            }
        }

        private static void AddRsaSha256AlgorithmToCryptoConfig()
        {
            const string signatureMethod = "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256";
            
            if (CryptoConfig.CreateFromName(signatureMethod) == null)
                CryptoConfig.AddAlgorithm(typeof(RsaPkCs1Sha256SignatureDescription), signatureMethod);
        }


        [TestClass]
        public class KonstruktørMethod : ResponsvalidatorTester
        {
            [TestMethod]
            public void EnkelKonstruktørMedMiljø()
            {
                ////Arrange
                var sendtMelding = SendtMeldingXmlDocument;
                var miljø = Miljø.Test;
                Responsvalidator responsvalidator = new Responsvalidator(_responsTransportkvitteringXmlTestmiljø, sendtMelding, miljø);

                //Act

                //Assert
                Assert.AreEqual(miljø, responsvalidator.KjørendeMiljø);
            }
        }

        [TestClass]
        public class ValiderTransportkvitteringMethod : ResponsvalidatorTester
        {
            [TestMethod]
            public void TestsertifikatValiderer()
            {
                //Arrange
                AddRsaSha256AlgorithmToCryptoConfig();

                var miljø = Miljø.Test;
                Responsvalidator responsvalidator = new Responsvalidator(_responsTransportkvitteringXmlTestmiljø, SendtMeldingXmlDocument, miljø);
                GuidUtility guidUtility = new GuidUtility()
                {
                    BinarySecurityTokenId = "X509-513ffecb-cd7e-4bb3-a4c5-47eff314683f",
                    BodyId = "soapBody",
                    DokumentpakkeId = "4fa27c07-8a0f-45a9-954e-c658f6c480af@meldingsformidler.sdp.difi.no",
                    EbMessagingId = "id-68ae7123-bf5c-4d15-835c-4a6b91106e77",
                    StandardBusinessDocumentHeaderId = "388214db-29cc-43c7-9543-877e017e5bb4",
                    TimestampId = "TS-76740c34-88d2-4bb6-82d2-9e9f0e474087"
                };

                //Act
                responsvalidator.ValiderTransportkvittering(guidUtility);
                
                //Assert
            }
        }


        [TestClass]
        public class ValiderMeldingsKvitteringMethod : ResponsvalidatorTester
        {
            [TestMethod]
            public void TestsertifikatValiderer()
            {
                //Arrange
                AddRsaSha256AlgorithmToCryptoConfig();
                var miljø = Miljø.Test;

                XmlDocument sendtKvitteringsForespørsel = new XmlDocument();
                sendtKvitteringsForespørsel.LoadXml(_sendtKvitteringsforespørsel);
                Responsvalidator responsvalidator = new Responsvalidator(respons: _responsKvitteringsForespørsel, sendtMelding: sendtKvitteringsForespørsel, kjørendeMiljø: miljø);

                //Act
                responsvalidator.ValiderMeldingskvittering();

                //Assert
            }
        }

        [TestClass]
        public class ValiderTomKøKvitteringMethod : ResponsvalidatorTester
        {
            [TestMethod]
            public void TestsertifikatValiderer()
            {
                //Arrange
                AddRsaSha256AlgorithmToCryptoConfig();

                var miljø = Miljø.Test;
                XmlDocument sendtKvitteringsForespørsel = new XmlDocument();
                sendtKvitteringsForespørsel.LoadXml(_sendtKvitteringsforespørsel);
                Responsvalidator responsvalidator = new Responsvalidator(_tomKøKvittering, sendtKvitteringsForespørsel, miljø);
                
                //Act
                responsvalidator.ValiderTomkøkvittering();

                //Assert
            }
        }
    }
}